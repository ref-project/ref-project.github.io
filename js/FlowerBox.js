// COPYRIGHT:
// Google Inc., Kevin Shannon, and others

function initShaders(e,t,r){var a,i,n=document.getElementById(t);if(!n)return alert("Unable to load vertex shader "+t),-1;if(a=e.createShader(e.VERTEX_SHADER),e.shaderSource(a,n.text),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS)){var o="Vertex shader failed to compile.  The error log is:<pre>"+e.getShaderInfoLog(a)+"</pre>";return alert(o),-1}var s=document.getElementById(r);if(!s)return alert("Unable to load vertex shader "+r),-1;if(i=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(i,s.text),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){o="Fragment shader failed to compile.  The error log is:<pre>"+e.getShaderInfoLog(i)+"</pre>";return alert(o),-1}var c=e.createProgram();if(e.attachShader(c,a),e.attachShader(c,i),e.linkProgram(c),!e.getProgramParameter(c,e.LINK_STATUS)){o="Shader program failed to link.  The error log is:<pre>"+e.getProgramInfoLog(c)+"</pre>";return alert(o),-1}return c}function _argumentsToArray(e){return[].concat.apply([],Array.prototype.slice.apply(e))}function radians(e){return e*Math.PI/180}function vec2(){var e=_argumentsToArray(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0)}return e.splice(0,2)}function vec3(){var e=_argumentsToArray(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0);case 2:e.push(0)}return e.splice(0,3)}function vec4(){var e=_argumentsToArray(arguments);switch(e.length){case 0:e.push(0);case 1:e.push(0);case 2:e.push(0);case 3:e.push(1)}return e.splice(0,4)}function mat2(){var e=_argumentsToArray(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[vec2(e[0],0),vec2(0,e[0])];break;default:t.push(vec2(e)),e.splice(0,2),t.push(vec2(e))}return t.matrix=!0,t}function mat3(){var e=_argumentsToArray(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[vec3(e[0],0,0),vec3(0,e[0],0),vec3(0,0,e[0])];break;default:t.push(vec3(e)),e.splice(0,3),t.push(vec3(e)),e.splice(0,3),t.push(vec3(e))}return t.matrix=!0,t}function mat4(){var e=_argumentsToArray(arguments),t=[];switch(e.length){case 0:e[0]=1;case 1:t=[vec4(e[0],0,0,0),vec4(0,e[0],0,0),vec4(0,0,e[0],0),vec4(0,0,0,e[0])];break;default:t.push(vec4(e)),e.splice(0,4),t.push(vec4(e)),e.splice(0,4),t.push(vec4(e)),e.splice(0,4),t.push(vec4(e))}return t.matrix=!0,t}function equal(e,t){if(e.length!=t.length)return!1;if(e.matrix&&t.matrix)for(var r=0;r<e.length;++r){if(e[r].length!=t[r].length)return!1;for(var a=0;a<e[r].length;++a)if(e[r][a]!==t[r][a])return!1}else{if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)return!1;for(r=0;r<e.length;++r)if(e[r]!==t[r])return!1}return!0}function add(e,t){var r=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"add(): trying to add matrices of different dimensions";for(var a=0;a<e.length;++a){if(e[a].length!=t[a].length)throw"add(): trying to add matrices of different dimensions";r.push([]);for(var i=0;i<e[a].length;++i)r[a].push(e[a][i]+t[a][i])}return r.matrix=!0,r}if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)throw"add(): trying to add matrix and non-matrix variables";if(e.length!=t.length)throw"add(): vectors are not the same dimension";for(a=0;a<e.length;++a)r.push(e[a]+t[a]);return r}function subtract(e,t){var r=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"subtract(): trying to subtract matrices of different dimensions";for(var a=0;a<e.length;++a){if(e[a].length!=t[a].length)throw"subtract(): trying to subtact matrices of different dimensions";r.push([]);for(var i=0;i<e[a].length;++i)r[a].push(e[a][i]-t[a][i])}return r.matrix=!0,r}if(e.matrix&&!t.matrix||!e.matrix&&t.matrix)throw"subtact(): trying to subtact  matrix and non-matrix variables";if(e.length!=t.length)throw"subtract(): vectors are not the same length";for(a=0;a<e.length;++a)r.push(e[a]-t[a]);return r}function mult(e,t){var r=[];if(e.matrix&&t.matrix){if(e.length!=t.length)throw"mult(): trying to add matrices of different dimensions";for(var a=0;a<e.length;++a)if(e[a].length!=t[a].length)throw"mult(): trying to add matrices of different dimensions";for(a=0;a<e.length;++a){r.push([]);for(var i=0;i<t.length;++i){for(var n=0,o=0;o<e.length;++o)n+=e[a][o]*t[o][i];r[a].push(n)}}return r.matrix=!0,r}if(e.matrix&&e.length==t.length){for(a=0;a<t.length;a++){for(n=0,i=0;i<t.length;i++)n+=e[a][i]*t[i];r.push(n)}return r}if(e.length!=t.length)throw"mult(): vectors are not the same dimension";for(a=0;a<e.length;++a)r.push(e[a]*t[a]);return r}function translate(e,t,r){Array.isArray(e)&&3==e.length&&(r=e[2],t=e[1],e=e[0]);var a=mat4();return a[0][3]=e,a[1][3]=t,a[2][3]=r,a}function rotate(e,t){Array.isArray(t)||(t=[arguments[1],arguments[2],arguments[3]]);var r=normalize(t),a=r[0],i=r[1],n=r[2],o=Math.cos(radians(e)),s=1-o,c=Math.sin(radians(e));return mat4(vec4(a*a*s+o,a*i*s-n*c,a*n*s+i*c,0),vec4(a*i*s+n*c,i*i*s+o,i*n*s-a*c,0),vec4(a*n*s-i*c,i*n*s+a*c,n*n*s+o,0),vec4())}function rotateX(e){var t=Math.cos(radians(e)),r=Math.sin(radians(e));return mat4(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1)}function rotateY(e){var t=Math.cos(radians(e)),r=Math.sin(radians(e));return mat4(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1)}function rotateZ(e){var t=Math.cos(radians(e)),r=Math.sin(radians(e));return mat4(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1)}function scalem(e,t,r){Array.isArray(e)&&3==e.length&&(r=e[2],t=e[1],e=e[0]);var a=mat4();return a[0][0]=e,a[1][1]=t,a[2][2]=r,a}function lookAt(e,t,r){if(!Array.isArray(e)||3!=e.length)throw"lookAt(): first parameter [eye] must be an a vec3";if(!Array.isArray(t)||3!=t.length)throw"lookAt(): first parameter [at] must be an a vec3";if(!Array.isArray(r)||3!=r.length)throw"lookAt(): first parameter [up] must be an a vec3";if(equal(e,t))return mat4();var a=normalize(subtract(t,e)),i=normalize(cross(a,r)),n=normalize(cross(i,a));return a=negate(a),mat4(vec4(i,-dot(i,e)),vec4(n,-dot(n,e)),vec4(a,-dot(a,e)),vec4())}function ortho(e,t,r,a,i,n){if(e==t)throw"ortho(): left and right are equal";if(r==a)throw"ortho(): bottom and top are equal";if(i==n)throw"ortho(): near and far are equal";var o=t-e,s=a-r,c=n-i,l=mat4();return l[0][0]=2/o,l[1][1]=2/s,l[2][2]=-2/c,l[0][3]=-(e+t)/o,l[1][3]=-(a+r)/s,l[2][3]=-(i+n)/c,l}function perspective(e,t,r,a){var i=1/Math.tan(radians(e)/2),n=a-r,o=mat4();return o[0][0]=i/t,o[1][1]=i,o[2][2]=-(r+a)/n,o[2][3]=-2*r*a/n,o[3][2]=-1,o[3][3]=0,o}function transpose(e){if(!e.matrix)return"transpose(): trying to transpose a non-matrix";for(var t=[],r=0;r<e.length;++r){t.push([]);for(var a=0;a<e[r].length;++a)t[r].push(e[a][r])}return t.matrix=!0,t}function dot(e,t){if(e.length!=t.length)throw"dot(): vectors are not the same dimension";for(var r=0,a=0;a<e.length;++a)r+=e[a]*t[a];return r}function negate(e){for(var t=[],r=0;r<e.length;++r)t.push(-e[r]);return t}function cross(e,t){if(!Array.isArray(e)||e.length<3)throw"cross(): first argument is not a vector of at least 3";if(!Array.isArray(t)||t.length<3)throw"cross(): second argument is not a vector of at least 3";return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function length(e){return Math.sqrt(dot(e,e))}function normalize(e,t){if(t)var r=e.pop();var a=length(e);if(!isFinite(a))throw"normalize: vector "+e+" has zero length";for(var i=0;i<e.length;++i)e[i]/=a;return t&&e.push(r),e}function mix(e,t,r){if("number"!=typeof r)throw"mix: the last paramter "+r+" must be a number";if(e.length!=t.length)throw"vector dimension mismatch";for(var a=[],i=0;i<e.length;++i)a.push((1-r)*e[i]+r*t[i]);return a}function scale(e,t){if(!Array.isArray(t))throw"scale: second parameter "+t+" is not a vector";for(var r=[],a=0;a<t.length;++a)r.push(e*t[a]);return r}function flatten(e){!0===e.matrix&&(e=transpose(e));var t=e.length,r=!1;Array.isArray(e[0])&&(r=!0,t*=e[0].length);var a=new Float32Array(t);if(r)for(var i=0,n=0;n<e.length;++n)for(var o=0;o<e[n].length;++o)a[i++]=e[n][o];else for(n=0;n<e.length;++n)a[n]=e[n];return a}WebGLUtils=function(){var e=function(e,t){for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],a=null,i=0;i<r.length;++i){try{a=e.getContext(r[i],t)}catch(e){}if(a)break}return a};return{create3DContext:e,setupWebGL:function(t,r){function a(e){var r=t.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>")}if(!window.WebGLRenderingContext)return a('This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>'),null;var i=e(t,r);return i||a('It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'),i}}}(),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)};var sizeof={vec2:new Float32Array(flatten(vec2())).byteLength,vec3:new Float32Array(flatten(vec3())).byteLength,vec4:new Float32Array(flatten(vec4())).byteLength,mat2:new Float32Array(flatten(mat2())).byteLength,mat3:new Float32Array(flatten(mat3())).byteLength,mat4:new Float32Array(flatten(mat4())).byteLength};function printm(e){if(2==e.length)for(var t=0;t<e.length;t++)console.log(e[t][0],e[t][1]);else if(3==e.length)for(t=0;t<e.length;t++)console.log(e[t][0],e[t][1],e[t][2]);else if(4==e.length)for(t=0;t<e.length;t++)console.log(e[t][0],e[t][1],e[t][2],e[t][3])}function det2(e){return e[0][0]*e[1][1]-e[0][1]*e[1][0]}function det3(e){return e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[2][1]*e[1][0]-e[2][0]*e[1][1]*e[0][2]-e[1][0]*e[0][1]*e[2][2]-e[0][0]*e[1][2]*e[2][1]}function det4(e){var t=[vec3(e[1][1],e[1][2],e[1][3]),vec3(e[2][1],e[2][2],e[2][3]),vec3(e[3][1],e[3][2],e[3][3])],r=[vec3(e[1][0],e[1][2],e[1][3]),vec3(e[2][0],e[2][2],e[2][3]),vec3(e[3][0],e[3][2],e[3][3])],a=[vec3(e[1][0],e[1][1],e[1][3]),vec3(e[2][0],e[2][1],e[2][3]),vec3(e[3][0],e[3][1],e[3][3])],i=[vec3(e[1][0],e[1][1],e[1][2]),vec3(e[2][0],e[2][1],e[2][2]),vec3(e[3][0],e[3][1],e[3][2])];return e[0][0]*det3(t)-e[0][1]*det3(r)+e[0][2]*det3(a)-e[0][3]*det3(i)}function det(e){return 1!=e.matrix&&console.log("not a matrix"),2==e.length?det2(e):3==e.length?det3(e):4==e.length?det4(e):void 0}function inverse2(e){var t=mat2(),r=det2(e);return t[0][0]=e[1][1]/r,t[0][1]=-e[0][1]/r,t[1][0]=-e[1][0]/r,t[1][1]=e[0][0]/r,t.matrix=!0,t}function inverse3(e){var t=mat3(),r=det3(e),a=[vec2(e[1][1],e[1][2]),vec2(e[2][1],e[2][2])],i=[vec2(e[1][0],e[1][2]),vec2(e[2][0],e[2][2])],n=[vec2(e[1][0],e[1][1]),vec2(e[2][0],e[2][1])],o=[vec2(e[0][1],e[0][2]),vec2(e[2][1],e[2][2])],s=[vec2(e[0][0],e[0][2]),vec2(e[2][0],e[2][2])],c=[vec2(e[0][0],e[0][1]),vec2(e[2][0],e[2][1])],l=[vec2(e[0][1],e[0][2]),vec2(e[1][1],e[1][2])],u=[vec2(e[0][0],e[0][2]),vec2(e[1][0],e[1][2])],v=[vec2(e[0][0],e[0][1]),vec2(e[1][0],e[1][1])];return t[0][0]=det2(a)/r,t[0][1]=-det2(o)/r,t[0][2]=det2(l)/r,t[1][0]=-det2(i)/r,t[1][1]=det2(s)/r,t[1][2]=-det2(u)/r,t[2][0]=det2(n)/r,t[2][1]=-det2(c)/r,t[2][2]=det2(v)/r,t}function inverse4(e){var t=mat4(),r=det4(e),a=[vec3(e[1][1],e[1][2],e[1][3]),vec3(e[2][1],e[2][2],e[2][3]),vec3(e[3][1],e[3][2],e[3][3])],i=[vec3(e[1][0],e[1][2],e[1][3]),vec3(e[2][0],e[2][2],e[2][3]),vec3(e[3][0],e[3][2],e[3][3])],n=[vec3(e[1][0],e[1][1],e[1][3]),vec3(e[2][0],e[2][1],e[2][3]),vec3(e[3][0],e[3][1],e[3][3])],o=[vec3(e[1][0],e[1][1],e[1][2]),vec3(e[2][0],e[2][1],e[2][2]),vec3(e[3][0],e[3][1],e[3][2])],s=[vec3(e[0][1],e[0][2],e[0][3]),vec3(e[2][1],e[2][2],e[2][3]),vec3(e[3][1],e[3][2],e[3][3])],c=[vec3(e[0][0],e[0][2],e[0][3]),vec3(e[2][0],e[2][2],e[2][3]),vec3(e[3][0],e[3][2],e[3][3])],l=[vec3(e[0][0],e[0][1],e[0][3]),vec3(e[2][0],e[2][1],e[2][3]),vec3(e[3][0],e[3][1],e[3][3])],u=[vec3(e[0][0],e[0][1],e[0][2]),vec3(e[2][0],e[2][1],e[2][2]),vec3(e[3][0],e[3][1],e[3][2])],v=[vec3(e[0][1],e[0][2],e[0][3]),vec3(e[1][1],e[1][2],e[1][3]),vec3(e[3][1],e[3][2],e[3][3])],f=[vec3(e[0][0],e[0][2],e[0][3]),vec3(e[1][0],e[1][2],e[1][3]),vec3(e[3][0],e[3][2],e[3][3])],g=[vec3(e[0][0],e[0][1],e[0][3]),vec3(e[1][0],e[1][1],e[1][3]),vec3(e[3][0],e[3][1],e[3][3])],d=[vec3(e[0][0],e[0][1],e[0][2]),vec3(e[1][0],e[1][1],e[1][2]),vec3(e[3][0],e[3][1],e[3][2])],h=[vec3(e[0][1],e[0][2],e[0][3]),vec3(e[1][1],e[1][2],e[1][3]),vec3(e[2][1],e[2][2],e[2][3])],m=[vec3(e[0][0],e[0][2],e[0][3]),vec3(e[1][0],e[1][2],e[1][3]),vec3(e[2][0],e[2][2],e[2][3])],p=[vec3(e[0][0],e[0][1],e[0][3]),vec3(e[1][0],e[1][1],e[1][3]),vec3(e[2][0],e[2][1],e[2][3])],_=[vec3(e[0][0],e[0][1],e[0][2]),vec3(e[1][0],e[1][1],e[1][2]),vec3(e[2][0],e[2][1],e[2][2])];return t[0][0]=det3(a)/r,t[0][1]=-det3(s)/r,t[0][2]=det3(v)/r,t[0][3]=-det3(h)/r,t[1][0]=-det3(i)/r,t[1][1]=det3(c)/r,t[1][2]=-det3(f)/r,t[1][3]=det3(m)/r,t[2][0]=det3(n)/r,t[2][1]=-det3(l)/r,t[2][2]=det3(g)/r,t[2][3]=-det3(p)/r,t[3][0]=-det3(o)/r,t[3][1]=det3(u)/r,t[3][2]=-det3(d)/r,t[3][3]=det3(_)/r,t}function inverse(e){return 1!=e.matrix&&console.log("not a matrix"),2==e.length?inverse2(e):3==e.length?inverse3(e):4==e.length?inverse4(e):void 0}function normalMatrix(e,t){var r=mat4();if(r=inverse(transpose(e)),1!=t)return r;for(var a=mat3(),i=0;i<3;i++)for(var n=0;n<3;n++)a[i][n]=r[i][n];return a}var indices=[],normals=[],vertices=[];class Surface{constructor(e,t,r,a,i,n){this.x_initial=e,this.x_final=t,this.y_initial=r,this.y_final=a,this.x_divisions=i,this.y_divisions=n,this.numIndices=(i-1)*(n-1)*6}}var canvas,gl,u_lightPosition,u_ambientProduct,u_diffuseProduct,u_specularProduct,u_shininess,modelView,a_vertexPosition,subdiv=13,square=new Surface(-1,1,-1,1,subdiv,subdiv);function generate_geometry(e,t){normals=[],vertices=[];var r=new Array(e.x_divisions),a=new Array(e.y_divisions),i=(e.x_final-e.x_initial)/(e.x_divisions-1),n=(e.y_final-e.y_initial)/(e.y_divisions-1);for(let t=0;t<e.x_divisions;t++)r[t]=i*t+e.x_initial;for(let t=0;t<e.y_divisions;t++)a[t]=n*t+e.y_initial;for(const e of r)for(const r of a){var o=vec3(e,r,1),s=vec3(o),c=5-Math.abs(t%7.5*1.6-6);vertices.push(mix(o,normalize(s),c))}for(let t=0;t<e.x_divisions;t++)for(let r=0;r<e.y_divisions;r++){var l=vertices[t*e.y_divisions+r],u=vertices[t*e.y_divisions+r-1],v=vertices[t*e.y_divisions+r+1],f=vertices[(t-1)*e.y_divisions+r],g=vertices[(t+1)*e.y_divisions+r];r%e.x_divisions==0?partial_x=subtract(v,l):(r+1)%e.x_divisions==0?partial_x=subtract(l,u):partial_x=add(subtract(v,l),subtract(l,u)),t%e.y_divisions==0?partial_y=subtract(g,l):(t+1)%e.y_divisions==0?partial_y=subtract(l,f):partial_y=add(subtract(g,l),subtract(l,f)),normals.push(vec4(normalize(cross(partial_y,partial_x)),0))}}function generate_indices(e){indices=[];for(var t=0;t<e.x_divisions-1;t++)for(var r=0;r<e.y_divisions-1;r++)a=t*e.x_divisions+r,b=t*e.x_divisions+r+1,c=(t+1)*e.x_divisions+r+1,d=(t+1)*e.x_divisions+r,indices.push(a),indices.push(b),indices.push(c),indices.push(a),indices.push(c),indices.push(d)}var mvMatrix,u_mvMatrix,projMatrix,u_projMatrix,viewer={eye:vec3(0,0,5),at:vec3(0,0,0),up:vec3(0,1,0)},perspProj={fov:60,aspect:1,near:.001,far:10},shininess=30,time=.625,delta_t=.01,sz=.5,pos=[0,0],speed_r=88,speed_x=-.006,speed_y=.006,max_x=2.1,max_y=1.7;class Light{constructor(e,t,r,a){this.position=e,this.ambient=t,this.diffuse=r,this.specular=a}}var light=new Light(vec4(0,0,0,1),vec4(.2,.2,.2,1),vec4(.9,.9,.9,1),vec4(.5,.5,.5,1));class Material{constructor(e,t,r){this.ambient=e,this.diffuse=t,this.specular=r}}var shape,aspect_ratio,program,vBuffer,vPosition,nBuffer,vNormal,iBuffer,materials={cyan:new Material(vec4(0,1,1,1),vec4(0,1,1,1),vec4(1,1,1,1)),magenta:new Material(vec4(1,0,1,1),vec4(1,0,1,1),vec4(1,1,1,1)),yellow:new Material(vec4(1,1,0,1),vec4(1,1,0,1),vec4(1,1,1,1)),red:new Material(vec4(1,0,0,1),vec4(1,0,0,1),vec4(1,1,1,1)),green:new Material(vec4(0,1,0,1),vec4(0,1,0,1),vec4(1,1,1,1)),blue:new Material(vec4(0,0,1,1),vec4(0,0,1,1),vec4(1,1,1,1))},faces={front:{orientation:[0,0],material:"cyan"},left:{orientation:[0,90],material:"magenta"},back:{orientation:[0,180],material:"yellow"},right:{orientation:[0,270],material:"blue"},top:{orientation:[90,0],material:"red"},bottom:{orientation:[270,0],material:"green"}};function resize(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,aspect_ratio=canvas.width/canvas.height,gl.viewport(0,0,canvas.width,canvas.height)}window.onresize=resize,window.onload=function(){canvas=document.getElementById("gl-canvas");(gl=WebGLUtils.setupWebGL(canvas)).getExtension("OES_element_index_uint");gl||alert("WebGL isn't available"),resize(),gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST),generate_geometry(square,time),generate_indices(square),shape=square,program=initShaders(gl,"vertex-shader1","fragment-shader"),gl.useProgram(program),gl.enable(gl.CULL_FACE),gl.cullFace(gl.FRONT),iBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,iBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(indices),gl.STATIC_DRAW),vBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,vBuffer),gl.bufferData(gl.ARRAY_BUFFER,flatten(vertices),gl.STATIC_DRAW),vPosition=gl.getAttribLocation(program,"a_vertexPosition"),gl.vertexAttribPointer(vPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(vPosition),nBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,nBuffer),gl.bufferData(gl.ARRAY_BUFFER,flatten(normals),gl.STATIC_DRAW),vNormal=gl.getAttribLocation(program,"a_vertexNormal"),gl.vertexAttribPointer(vNormal,4,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(vNormal),u_mvMatrix=gl.getUniformLocation(program,"u_mvMatrix"),u_projMatrix=gl.getUniformLocation(program,"u_projMatrix"),u_lightPosition=gl.getUniformLocation(program,"u_lightPosition"),u_ambientProduct=gl.getUniformLocation(program,"u_ambientProduct"),u_diffuseProduct=gl.getUniformLocation(program,"u_diffuseProduct"),u_specularProduct=gl.getUniformLocation(program,"u_specularProduct"),u_shininess=gl.getUniformLocation(program,"u_shininess"),document.getElementById("gl-canvas").onmousedown=function(){generate_indices(shape=new Surface(-1,1,-1,1,subdiv=13===subdiv?50:13,subdiv)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,iBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(indices),gl.STATIC_DRAW)},render()};var render=function(){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),time+=delta_t,pos[0]+=speed_x,pos[1]+=speed_y,Math.abs(pos[0])>max_x&&(speed_x=-speed_x),Math.abs(pos[1])>max_y&&(speed_y=-speed_y),generate_geometry(shape,time),gl.bindBuffer(gl.ARRAY_BUFFER,vBuffer),gl.bufferData(gl.ARRAY_BUFFER,flatten(vertices),gl.STATIC_DRAW),gl.vertexAttribPointer(vPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(vPosition),gl.bindBuffer(gl.ARRAY_BUFFER,nBuffer),gl.bufferData(gl.ARRAY_BUFFER,flatten(normals),gl.STATIC_DRAW),gl.vertexAttribPointer(vNormal,4,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(vNormal),pjMatrix=perspective(perspProj.fov,perspProj.aspect,perspProj.near,perspProj.far),gl.uniformMatrix4fv(u_projMatrix,!1,flatten(pjMatrix));var e=lookAt(viewer.eye,viewer.at,viewer.up);for(face in e=mult(e,scalem(sz/aspect_ratio,sz,sz)),e=mult(e,rotateY(speed_r*time)),e=mult(e,rotateZ(speed_r*time)),faces)mvMatrix=mult(e,rotateX(faces[face].orientation[0])),mvMatrix=mult(mvMatrix,rotateY(faces[face].orientation[1])),mvMatrix=mult(translate(pos[0],pos[1],0),mvMatrix),gl.uniformMatrix4fv(u_mvMatrix,!1,flatten(mvMatrix)),ambientProduct=mult(light.ambient,materials[faces[face].material].ambient),diffuseProduct=mult(light.diffuse,materials[faces[face].material].diffuse),specularProduct=mult(light.specular,materials[faces[face].material].specular),gl.uniform4fv(u_lightPosition,flatten(light.position)),gl.uniform4fv(u_ambientProduct,flatten(ambientProduct)),gl.uniform4fv(u_diffuseProduct,flatten(diffuseProduct)),gl.uniform4fv(u_specularProduct,flatten(specularProduct)),gl.uniform1f(u_shininess,shininess),gl.drawElements(gl.TRIANGLES,shape.numIndices,gl.UNSIGNED_INT,0);requestAnimFrame(render)};